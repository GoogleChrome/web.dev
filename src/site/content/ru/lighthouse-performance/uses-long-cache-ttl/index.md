---
layout: post
title: Обслуживайте статические ресурсы сайта с помощью эффективной политики кеширования
description: Узнайте, как кеширование статических ресурсов вашей веб-страницы может повысить производительность и надежность для повторных посетителей.
date: 2019-05-02
updated: 2019-10-04
web_lighthouse:
  - uses-long-cache-ttl
---

HTTP-кеширование может ускорить загрузку вашей страницы при повторных посещениях.

Когда браузер запрашивает ресурс, сервер, предоставляющий ресурс, может сообщить браузеру, как долго он должен временно хранить или *кешировать* ресурс. При любом последующем запросе этого ресурса браузер использует свою локальную копию, а не получает ее из сети.

## Причины плохих результатов проверки политики кеширования в Lighthouse

[Lighthouse](https://developer.chrome.com/docs/lighthouse/overview/) отмечает все статические ресурсы, которые не кешируются:

<figure>{% Img src="image/tcFciHGuF3MxnTr1y5ue01OGLBn2/vtRp9i6zzD8EDlHYkHtQ.png", alt="Скриншот проверки Lighthouse «Обслуживание статических ресурсов с эффективной политикой кеширования»", width="800", height="490" %}</figure>

Lighthouse считает ресурс кешируемым, если выполняются все следующие условия:

- ресурс — это шрифт, изображение, медиафайл, скрипт или таблица стилей;
- ресурс имеет [код состояния HTTP](https://developer.mozilla.org/docs/Web/HTTP/Status) `200`, `203` или `206`;
- у ресурса нет явной политики отсутствия кеширования.

Если страница не проходит проверку, Lighthouse отображает результаты в таблице с тремя столбцами:

<div class="table-wrapper scrollbar">
  <table>
    <tbody>
      <tr>
        <td><strong>URL</strong></td>
        <td>Расположение кешируемого ресурса</td>
      </tr>
      <tr>
        <td><strong>TTL кеша</strong></td>
        <td>Текущая продолжительность кеширования ресурса</td>
      </tr>
      <tr>
        <td><strong>Размер</strong></td>
        <td>Примерный объем данных, которые ваши пользователи сохранили бы, если бы отмеченный ресурс был кеширован.</td>
      </tr>
    </tbody>
  </table>
</div>

{% include 'content/lighthouse-performance/scoring.njk' %}

## Как кешировать статические ресурсы с помощью HTTP-кеширования

Настройте свой сервер так, чтобы он возвращал заголовок HTTP-ответа `Cache-Control`:

```js
Cache-Control: max-age=31536000
```

`max-age` сообщает браузеру, как долго он должен кешировать ресурс в секундах. В этом примере устанавливается продолжительность `31536000`, что соответствует 1 году: 60 секунд × 60 минут × 24 часа × 365 дней = 31536000 секунд.

По возможности кешируйте неизменяемые статические ресурсы на долгое время, например на год или дольше.

{% Aside %} Один из рисков длительного использования кеша заключается в том, что ваши пользователи не увидят обновленные статические файлы. Вы можете избежать этой проблемы, настроив свой инструмент сборки для встраивания хеша в имена файлов статических ресурсов, чтобы каждая версия была уникальной, и предложив браузеру получать новую версию с сервера. (Чтобы узнать, как встраивать хеши с помощью webpack, см. руководство по [кешированию](https://webpack.js.org/guides/caching/) webpack.) {% endAside %}

Если ресурс часто меняется и важна его актуальность, используйте `no-cache`, чтобы воспользоваться преимуществами кеширования с точки зрения скорости загрузки. Браузер по-прежнему кеширует ресурс, для которого установлено значение `no-cache`, но сначала проверяет его на сервере, чтобы убедиться, что ресурс всё еще актуален.

Более длительный срок хранения кеша не всегда лучше. В конечном итоге вам решать, какова оптимальная продолжительность кеширования ресурсов.

Существует множество директив для настройки того, как браузер кеширует различные ресурсы. Дополнительные сведения о кешировании ресурсов см. в статьях [«HTTP-кеширование: руководство по первой линии обороны»](/http-cache) и [«Codelab для настройки поведения HTTP-кеширования»](/codelab-http-cache).

## Как проверить кешированные ответы в Chrome DevTools

Чтобы узнать, какие ресурсы браузер получает из своего кеша, откройте вкладку **Network** в Chrome DevTools:

{% Instruction 'devtools-network', 'ol' %}

Столбец **Size** в Chrome DevTools может помочь вам убедиться, что ресурс был кеширован:

<figure>{% Img src="image/tcFciHGuF3MxnTr1y5ue01OGLBn2/dc7QffBFDTcTHyUNNevi.png", alt="Столбец Size.", width="800", height="565" %}</figure>

Chrome обслуживает наиболее запрашиваемые ресурсы из кеша памяти, который работает очень быстро, но очищается при закрытии браузера.

Чтобы убедиться, что заголовок ресурса `Cache-Control` установлен должным образом, проверьте данные его HTTP-заголовка:

1. Щелкните URL-адрес запроса в столбце **Name** таблицы запросов.
2. Щелкните вкладку **Headers**.

<figure>{% Img src="image/tcFciHGuF3MxnTr1y5ue01OGLBn2/dGDjkwsoUBwFVLYM0sVy.png", alt="Проверка заголовка Cache-Control на вкладке Headers", width="800", height="597" %} <figcaption> Проверка заголовка <code>Cache-Control</code> на вкладке <b>Headers</b>. </figcaption></figure>

## Рекомендации по стекам

### Drupal

Установите **максимальный возраст кеша браузера и прокси-сервера** на странице **Administration** &gt; **Configuration** &gt; **Development**. См. статью [«Сведения по оптимизации производительности Drupal»](https://www.drupal.org/docs/7/managing-site-performance-and-scalability/caching-to-improve-performance/caching-overview#s-drupal-performance-resources).

### Joomla

См. статью [«Кеш»](https://docs.joomla.org/Cache).

### WordPress

См. статью [«Кеширование в браузере»](https://wordpress.org/support/article/optimization/#browser-caching).

## Ресурсы

- [Исходный код проверки **Serve static assets with an efficient cache policy** (Обслуживайте статические ресурсы сайта с помощью эффективной политики кеширования).](https://github.com/GoogleChrome/lighthouse/blob/master/lighthouse-core/audits/byte-efficiency/uses-long-cache-ttl.js)
- [Спецификация Cache-Control](https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.9).
- [Описание заголовка Cache-Control (MDN)](https://developer.mozilla.org/docs/Web/HTTP/Headers/Cache-Control).
