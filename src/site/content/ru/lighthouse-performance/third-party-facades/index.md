---
layout: post
title: Отложенная загрузка сторонних ресурсов с помощью фасадов
description: |2

  Узнайте о возможностях отложенной загрузки сторонних ресурсов с помощью фасадов.
date: 2020-12-01
web_lighthouse:
  - third-party-facades
---

[Сторонние ресурсы](/third-party-javascript/) часто используются для показа рекламы или видео и интеграции с социальными сетями. По умолчанию сторонние ресурсы загружаются сразу после загрузки страницы, однако такой подход может излишне ее замедлить. Если сторонний контент не критичен, затраты на производительность можно снизить за счет [отложенной загрузки](/fast/#lazy-load-images-and-video).

Этот аудит выявляет сторонние встраиваемые файлы, для которых можно выполнить отложенную загрузку при взаимодействии. В этом случае вместо стороннего контента используется *фасад* до тех пор, пока пользователь не начнет с ним взаимодействовать.

{% Aside 'key-term' %}

*Фасад* — это статический элемент, который выглядит как реальный встроенный объект, при этом не работает и, следовательно, существенно снижает нагрузку на страницу.

{% endAside %}

<figure>{% Img src="image/tcFciHGuF3MxnTr1y5ue01OGLBn2/cvQ4fxFUG5MIXtUfi77Z.jpg", alt="Пример загрузки встроенного плеера YouTube с фасадом. Фасад весит 3 КБ, а плеер размером 540 КБ загружается при взаимодействии.", width="800 ", height="521" %} <figcaption>Загрузка встроенного плеера YouTube с фасадом. </figcaption></figure>

## Как Lighthouse обнаруживает сторонние встраиваемые объекты, допускающие отложенную загрузку

Lighthouse ищет сторонние продукты, которые можно отложить, такие как виджеты социальных сетей или встраиваемые видео (например, встроенный проигрыватель YouTube).

Данные о продуктах, допускающих отложенную загрузку, и доступных фасадах [хранятся в модуле third-party-web](https://github.com/patrickhulce/third-party-web/).

Аудит завершится ошибкой, если страница загружает ресурсы, относящиеся к одному из этих сторонних встраиваемых объектов.

<figure>{% Img src="image/tcFciHGuF3MxnTr1y5ue01OGLBn2/R0osncucBqYCIZfC85Hu.jpg", alt="Аудит фасада сторонних ресурсов Lighthouse, выделяющий встроенный проигрыватель Vimeo и живой чат Drift.", width="800", height="517" %} <figcaption> Аудит фасада сторонних ресурсов Lighthouse. </figcaption></figure>

## Как отложить загрузку сторонних ресурсов при помощи фасада

Вместо того, чтобы добавлять сторонние встраиваемые объекты непосредственно в свой HTML, загрузите страницу со статическим элементом, который имитирует реальный встроенный сторонний элемент. Схема взаимодействия должна выглядеть примерно так:

1. При загрузке: добавляем фасад на страницу.

2. При наведении указателя мыши: фасад предварительно подключается к сторонним ресурсам.

3. При нажатии: фасад заменяется сторонним продуктом.

## Рекомендуемые фасады

В целом, для встраиваемых видео, виджетов социальных кнопок и чатов можно использовать шаблон фасада. В приведенном ниже списке представлены наши рекомендации по фасадам с открытым исходным кодом. При выборе фасада учитывайте баланс между его размером и набором функций. Вы также можете использовать загрузчик iframe по требованию, например [vb/lazyframe](https://github.com/vb/lazyframe).

### Встроенный проигрыватель YouTube

- [paulirish/lite-youtube-embed](https://github.com/paulirish/lite-youtube-embed)

- [justinribeiro/lite-youtube](https://github.com/justinribeiro/lite-youtube)

- [Daugilas/lazyYT](https://github.com/Daugilas/lazyYT)

### Встроенный проигрыватель Vimeo

- [luwes/lite-vimeo-embed](https://github.com/luwes/lite-vimeo-embed)

- [slightlyoff/lite-vimeo](https://github.com/slightlyoff/lite-vimeo)

### Живые чаты (Intercom, Drift, Help Scout, Facebook Messenger)

- [calibreapp/react-live-chat-loader](https://github.com/calibreapp/react-live-chat-loader) ([публикация в блоге](https://calibreapp.com/blog/fast-live-chat))

{% Aside 'caution' %}

При отложенной загрузке сторонних ресурсов с использованием фасадов есть некоторые минусы, поскольку фасады не обладают полноценным функционалом реальных встраиваемых объектов. Например, на облачке Drift Live Chat есть значок, показывающий количество новых сообщений. Если облачко чата замещается фасадом, оно появляется, только когда загружается фактический виджет чата после того, как браузер запустит `requestIdleCallback`. Для встраиваемых видео автовоспроизведение может работать некорректно при отложенной загрузке.

{% endAside %}

## Написание собственного фасада

Вы можете [создать индивидуальное фасадное решение](https://wildbit.com/blog/2020/09/30/getting-postmark-lighthouse-performance-score-to-100#:~:text=What%20if%20we%20could%20replace%20the%20real%20widget), в котором будет применяться описанный выше паттерн взаимодействия. Фасад должен быть значительно меньше по сравнению с откладываемым сторонним продуктом и содержать только код, имитирующий внешний вид продукта.

Если вы хотите, чтобы ваше решение было включено в список выше, ознакомьтесь с [процедурой заявки](https://github.com/patrickhulce/third-party-web/blob/master/facades.md).

## Ресурсы

Исходный код для [аудита отложенной загрузки сторонних ресурсов с использованием фасадов](https://github.com/GoogleChrome/lighthouse/blob/master/lighthouse-core/audits/third-party-facades.js).
