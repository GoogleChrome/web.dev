---
layout: post-old
title: Удалить неиспользуемый код
subhead: |2

  npm упрощает добавление кода в ваш проект. Но действительно ли вы используете все

  эти лишние байты?
authors:
  - houssein
date: 2018-11-05
description: |2

  Реестры, такие как npm, изменили мир JavaScript к лучшему,

  позволяя любому легко загрузить и использовать более полумиллиона общедоступных

  пакеты. Но мы часто включаем библиотеки, которые не используем полностью. Чинить

  этой проблеме проанализируйте свой пакет, чтобы обнаружить неиспользуемый код.
codelabs:
  - codelab-remove-unused-code
tags:
  - performance
---

Реестры, такие как [npm](https://docs.npmjs.com/getting-started/what-is-npm) , изменили мир JavaScript к лучшему, позволив любому легко загрузить и использовать более *полумиллиона* общедоступных пакетов. Но мы часто включаем библиотеки, которые не используем полностью. Чтобы решить эту проблему, **проанализируйте свой пакет,** чтобы обнаружить неиспользуемый код. Затем удалите **неиспользуемые** и **ненужные** библиотеки.

## Проанализируйте свой комплект

DevTools позволяет легко увидеть размер всех сетевых запросов: {% Instruction 'devtools-network', 'ol' %} {% Instruction 'disable-cache', 'ol' %} {% Instruction 'reload-page', 'ol' %}

{% Img src = "image/admin/aq6QZj5p4KTuaWnUJnLC.png", alt = "Сетевая панель с запросом пакета", width = "800", height = "169", class = "w-screenshot"%}

На [вкладке «Покрытие](https://developer.chrome.com/docs/devtools/coverage/) » в DevTools также будет указано, сколько кода CSS и JS в вашем приложении не используется.

{% Img src = "image/admin/xlPdOMaeykJhYqGcaMJr.png", alt = "Покрытие кода в DevTools", width = "800", height = "562", class = "w-screenshot w-screenshot - fill" %}

Указав полную конфигурацию Lighthouse через интерфейс командной строки узла, можно также использовать аудит «Неиспользуемый JavaScript» для отслеживания количества неиспользуемого кода, поставляемого с вашим приложением.

{% Img src = "image/admin/tdC0d65gEIiHZy6eyo82.png", alt = "Lighthouse Unused JS Audit", width = "800", height = "347", class = "w-screenshot"%}

Если вы используете [webpack в](https://webpack.js.org/) качестве [связки, Webpack Bundle Analyzer](https://github.com/webpack-contrib/webpack-bundle-analyzer) поможет вам выяснить, что составляет пакет. Включите плагин в файл конфигурации вашего веб-пакета, как и любой другой плагин:

```js/4
module.exports = {
  //...
  plugins: [
    //...
    new BundleAnalyzerPlugin()
  ]
}
```

Хотя webpack обычно используется для создания одностраничных приложений, другие комплекты пакетов, такие как [Parcel](https://parceljs.org/) и [Rollup](https://rollupjs.org/guide/en) , также имеют инструменты визуализации, которые вы можете использовать для анализа вашего пакета.

При повторной загрузке приложения с включенным плагином отображается масштабируемая древовидная карта всего вашего пакета.

{% Img src = "image/admin/pLAHEtl5C011wTk2IJij.png", alt = "Анализатор пакетов Webpack", width = "800", height = "468"%}

Использование этой визуализации позволяет вам проверить, какие части вашего пакета больше других, а также получить лучшее представление обо всех библиотеках, которые вы импортируете. Это может помочь определить, используете ли вы какие-либо неиспользуемые или ненужные библиотеки.

## Удалите неиспользуемые библиотеки

На предыдущем изображении древовидной карты было довольно много пакетов в одном домене `@firebase` Если вашему веб-сайту нужен только компонент базы данных firebase, обновите импорт, чтобы получить эту библиотеку:

```js/1-2/0
import firebase from 'firebase';
import firebase from 'firebase/app';
import 'firebase/database';
```

Важно подчеркнуть, что этот процесс значительно сложнее для более крупных приложений.

Для загадочно выглядящего пакета, который, как вы совершенно уверены, нигде не используется, сделайте шаг назад и посмотрите, какие из ваших зависимостей верхнего уровня его используют. Попробуйте найти способ импортировать из него только те компоненты, которые вам нужны. Если вы не используете библиотеку, удалите ее. Если библиотека не требуется для начальной загрузки страницы, подумайте, можно ли ее [загружать лениво](/reduce-javascript-payloads-with-code-splitting) .

А если вы используете веб-пакет, ознакомьтесь [со списком плагинов, которые автоматически удаляют неиспользуемый код из популярных библиотек](https://github.com/GoogleChromeLabs/webpack-libs-optimizations) .

{% Aside 'codelab' %} [Удалите неиспользуемый код.](/codelab-remove-unused-code) {% endAside %}

## Удалите ненужные библиотеки

Не все библиотеки можно легко разбить на части и выборочно импортировать. В этих сценариях подумайте, можно ли полностью удалить библиотеку. Всегда стоит рассматривать создание индивидуального решения или использование более легкой альтернативы. Однако важно взвесить сложность и усилия, необходимые для любого из этих усилий, прежде чем полностью удалить библиотеку из приложения.
