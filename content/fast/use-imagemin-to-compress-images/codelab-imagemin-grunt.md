---
page_type: glitch
title: Using Imagemin with Grunt
author: khempenius
description: |
  In this codelab, learn how to use imagemin with grunt to optimize JPEG and
  PNG images for faster download.
web_updated_on: 2018-12-06
web_published_on: 2018-11-05
glitch: imagemin-grunt
---

## Install the Imagemin Grunt plugin

This Glitch already contains `grunt` and `grunt-cli` for you, but you'll need to
install `grunt-contrib-imagemin`.

- Click the **Remix This** button to make the project editable.

<web-screenshot type="remix"></web-screenshot>

- Click the **Status** button.

<web-screenshot type="status"></web-codelab>

- Then click the **Console** button.

<web-screenshot type="console"></web-codelab>

- Lastly, type this command into the console:

<pre class="devsite-terminal devsite-click-to-copy">
npm install --save-dev grunt-contrib-imagemin
</pre>

## Setup the Imagemin Grunt plugin

- To add the configuration for Imagemin, first replace
the `//Add configuration here` comment in `gruntfile.js` with this code block:

```javascript
imagemin: {
  dynamic: {
    files: [{
      cwd: 'images/',
      expand: true,
      src: ['**/*.{png,jpg}'],
    }]
  }
}
```

This code block tells Grunt which files should be compressed with Imagemin.

- `dynamic` indicates that the list of files to compress will be *dynamically*
  generated by matching the filenames against the specified file pattern.

- The file pattern `{cwd: 'images/', expand: true, src: ['**/*.{png,jpg}']}`
  will match all the JPEG and PNG images in the `images/` directory.

<div class="aside note">
Have more questions about this? You can read more about the Grunt file object
<a href="https://gruntjs.com/configuring-tasks#building-the-files-object-dynamically">here</a>.
</div>

- Load the Imagemin task by adding this line immediately before
  `grunt.registerTask(...)`:

<pre class="prettyprint">
<strong>grunt.loadNpmTasks('grunt-contrib-imagemin');</strong>
grunt.registerTask('default', [/* list plugins here */]);
</pre>


- Lastly, add Imagemin as the default Grunt task by replacing the `/* list plugins here */` comment with `'imagemin'`. That line should now look like this:

<pre class="prettyprint">
grunt.registerTask('default', <strong>['imagemin']</strong>);
</pre>

## ✔︎ Check-in

The complete `gruntfile.js` file should now look like this:

```javascript
const grunt = require('grunt')
grunt.initConfig({
  imagemin: {
    dynamic: {
      files: [{
        cwd: 'images/'
        expand: true,
        src: ['**/*.{png,jpg}'],
      }]
    }
  }
});
grunt.loadNpmTasks('grunt-contrib-imagemin');
grunt.registerTask('default', ['imagemin']);
```

## Customize your Imagemin Configuration

`imagemin-pngquant` is a plugin for specifying compression quality levels.

To add `imagemin-pngquant` to this project:

- Make sure the **Console** is open.

<web-screenshot type="console"></web-codelab>

- Install the plugin using npm by typing the following command into the console:

<pre class="devsite-terminal devsite-click-to-copy">
npm install --save-dev imagemin-pngquant
</pre>

- Declare the `imagemin-pngquant` plugin by adding this line to the top your
  `gruntfile.js`:

<pre class="prettyprint">
<strong>const pngquant = require('imagemin-pngquant');</strong>
const grunt = require('grunt')
grunt.initConfig({
  ...
</pre>

- Add settings for compressing PNG images by adding an `options` property to the
  `imagemin` object. That `options` property should look like this:

<pre class="prettyprint">
grunt.initConfig({
  imagemin: {
    <strong>options: {</strong>
      <strong>use: [</strong>
        <strong>pngquant({quality: '50'}),</strong>
      <strong>]</strong>
    <strong>},</strong>
    dynamic: {
  ...
</pre>

This code tells Grunt to compress PNGs to a quality of `50` (`0` is the worst;
`100` is the best) using the `imagemin-pngquant` plugin.

## ✔︎ Check-in

Your `gruntfile.js` file should now look like this:

```javascript
const pngquant = require('imagemin-pngquant');
const grunt = require('grunt')
grunt.initConfig({
  imagemin: {
    options: {
      use: [
        pngquant({quality: '50'}),
      ]
    },
    dynamic: {
      files: [{
        cwd: 'images/',
        expand: true,
        src: ['**/*.{png,jpg}'],
      }]
    }
  }
});
grunt.loadNpmTasks('grunt-contrib-imagemin');
grunt.registerTask('default', ['imagemin']);
```

But what about JPEGs? The project also has JPEG images, so you should specify how
they are compressed as well.

## Customize your Imagemin configuration (continued)

The `imagemin-mozjpeg` plugin can be used to compress JPEG images.

- Make sure the **Console** is open.

<web-screenshot type="console"></web-codelab>

- Install the plugin using npm by typing the following command into the console:

<pre class="devsite-terminal devsite-click-to-copy">
npm install --save-dev imagemin-mozjpeg
</pre>

- Declare the `imagemin-mozjpeg` plugin by putting this line at the top your
  `gruntfile.js`.

<pre class="prettyprint">
<strong>const mozjpeg = require('imagemin-mozjpeg');</strong>
const pngquant = require('imagemin-pngquant');
const grunt = require('grunt');
</pre>

- Next, add `mozjpeg({quality: '50'})` to the array in the `options` object.
  That array should now look like this:

<pre class="prettyprint">
grunt.initConfig({
  imagemin: {
    options: {
      use: [
        pngquant({quality: '50'}),
        <strong>mozjpeg({quality: '50'})</strong>
      ]
    },
    dynamic: {
</pre>

## ✔︎ Check-in

Your `gruntfile.js` file should now look like this:

```javascript
const mozjpeg = require('imagemin-mozjpeg');
const pngquant = require('imagemin-pngquant');
const grunt = require('grunt');
grunt.initConfig({
  imagemin: {
    options: {
      use: [
        pngquant({quality: '50'}),
        mozjpeg({quality: '50'})
      ]
    },
    dynamic: {
      files: [{
        cwd: 'images/',
        expand: true,
        src: ['**/*.{png,jpg}'],
      }]
    }
  }
});
grunt.loadNpmTasks('grunt-contrib-imagemin');
grunt.registerTask('default', ['imagemin']);
```

## Re-run Grunt & verify results with Lighthouse

<!-- TODO!: We should remove http-server from this Glitch! -->
- Make sure the **Console** is open.

<web-screenshot type="console"></web-codelab>

- Run Grunt by typing the following command into the console:

<pre class="devsite-terminal devsite-click-to-copy">
grunt
</pre>

When Grunt completes you should see a message like this in console:

`Minified 6 images (saved 667 kB - 66.5%)`

Hooray! These results are much better.

Lastly, it's a good idea to use Lighthouse to verify the changes that you just
made. Lighthouse's "Efficiently encode images" performance audit will let you
know if the JPEG images on your page are optimally compressed.

- Click on the **Show Live** button to view the live version of the your Glitch.

<web-screenshot type="show-live"></web-codelab>

- Run the Lighthouse performance audit (Lighthouse > Options > Performance) on
  the live version of your Glitch and verify that the "Efficiently encode
  images" audit was passed.

<img src="./lighthouse_passing.png" width="100%" alt="Passing 'Efficiently encode images' audit in Lighthouse">

Success! You have used Imagemin to optimally compress the images on your page.
